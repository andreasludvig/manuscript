{
  "hash": "ee1c69be6d939985f0476b6ce6c9444d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Geneset enrichment analysis\"\neditor_options: \n  chunk_output_type: console\nfig-width: 12\nfig-height: 10\n---\n\n\n\n## Pathway/gene set enrichment analysis\n\nAfter differential gene expression (DGE) analysis we have a long list of differentially expressed genes. Pathway enrichment analysis (PEA) is a common approach to summarise this long list of genes and interpret hundreds of DGEs at once. So instead of having a list of 20 000 genes, we may get a list of 50 or 60 biological pathways.\n\n![Summarise lists of DGEs to pathways](/images/GSE_analysis/pea.png)\n\nPathway enrichment analysis summarises the long gene list to a shorter and more easily interpretable list of pathways.\n\n### How does PEA work?\n\nFor a pathway enrichment analysis we need 3 ingredients.\n\n1.  Our **gene list** of interest, fx. a list of DGEs which we want to summarise.\n2.  A list of **background genes** - fx all of the genes in the human genome/transcriptome.\n3.  A list of **gene sets**. Gene sets are basically groups of related genes. Of course, for the algorithm to know if your list has a lot of genes related to breast cancer, or apoptosis, or cellular respiration, you need to tell it which genes are actually involved in breast cancer, apoptosis, and cellular respiration.\n\n![Components of a pathway enrichment analysis](/images/GSE_analysis/pea_2.png)\n\nPEA essentially compares our gene list to the background list to check if there are certain pathways **overrepresented**\n\nOne example could be: Alcoholic liver disease is usually involved in inflammatory processes, which often involve pro-inflammatory cytokines like IL-6. So, is there an **association** between our genes differentially expressed in alcoholic liver disease vs healthy cells and IL-6 production.\n\n![](/images/GSE_analysis/pea_3.png)\n\nIs our list of DGEs **enriched** with genes involved in IL-6 synthesis pathway?\n\n![](/images/GSE_analysis/pea_4.png)\n\nTo answer this question, we can build a contigency table. This will help us determine whether the fraction of genes of interest in the pathway is higher compared to the fraction of genes outside the pathway (so, backgound set). See the table below.\n\n![](/images/GSE_analysis/pea_5.png)\n\nWe have a column for differentially expressed and a column not differentially expressed genes, and then two rows, for genes that are annotated as being involved in IL-6 production and genes that are not involved in IL6 production.\n\nTo simplify things a lot, we will just look at 30 genes. 15 deferentially expressed genes were identified and of those, 12 genes were associated with the GO term interleukin-6 production.\n\nWe find that **12 of our 15** differentially expressed genes are involved in IL-6 production. We could quite confidently say that **our gene list is enriched with genes involved in IL-6 production.**\n\nBut what if there was 9 of our 15 involved in IL-6 production. is our gene list enriched with genes involved in IL-6 production? We need an objective statistical test to determine what is enriched and what is not. There are many methods, by the one that is commonly used in pathway enrichment analysis is fisher's exact test. I our p-value is really lwo we can safely say that our list is overrepresented with genes involved in IL-6 production, in other words, IL-6 prodcution is an immportant pathway in alchoholic liver diseases compared to healthy liver cells. Becayse we a testing thousands of pathways we till have to adjust p-values with a multiple-testing correction method.\n\nPathway enrichment analysis takes your **gene list** of interest and compares it to a **list of background genes** to check if there are certain pathways that are over-represented.\n\nSo it checks the fraction of your genes annotated to a specific Gene Ontology (GO) term. Then it checks the proportion of genes in the whole genome (your background set) that are annotated to that GO Term.\n\nThen, it gives you a **p-value** which tells you what is the probability that that pathway is actually over-represented in your gene list and it wasn't just coincidence.\n\n### Our analysis\n\nMark Burton have done the GSE analysis using four different databases, outlined below. I think we just use the vehicle control as the list of background genes. Otherwise he must have used some subset of only genes/pathways related to PHHs.\n\nGene Ontology (GO), KEGG, Reactome, and BioCarta are databases and tools that provide comprehensive information on gene and protein functions, interactions, and pathways. Each has its unique focus and strengths:\n\n1.  **Gene Ontology (GO)**\n\n    -   **Focus:** Provides a standardized vocabulary (ontologies) to describe gene and protein roles in cells. It covers three domains: Biological Process (BP), which describes the biological objectives to which the gene or gene product contributes; Molecular Function (MF), which describes the elemental activities of a gene product at the molecular level, such as binding or catalysis; and Cellular Component (CC), which describes where in the cell the gene product is active.\n\n    -   **Strengths:** Widely used for annotating genes and gene products across species; facilitates consistent descriptions of gene products even in the context of different studies.\n\n2.  **Kyoto Encyclopedia of Genes and Genomes (KEGG)**\n\n    -   **Focus:** Integrates genomic, chemical, and systemic functional information. KEGG provides pathways maps that represent molecular interaction and reaction networks, covering metabolism, genetic information processing, environmental information processing, cellular processes, organismal systems, and human diseases.\n\n    -   **Strengths:** Comprehensive in linking genes to functions through networks of interactions; useful for understanding high-level functions and utilities of the biological system.\n\n3.  **Reactome**\n\n    -   **Focus:** A curated database of pathways and reactions in human biology. Reactome pathways encompass various processes such as metabolism, signal transduction, gene expression, and cell cycle. It aims to provide a detailed, visual representation of molecular processes.\n\n    -   **Strengths:** Highly detailed and manually curated; provides an interactive pathway browser that facilitates the exploration of complex biological pathways; also includes pathways from other species, providing a comparative perspective.\n\n4.  **BioCarta**\n\n    -   **Focus:** Earlier widely used for providing graphical representations of molecular pathways, focusing on various biological and signaling pathways. BioCarta's pathways were known for highlighting the interactions between different molecules and the potential regulation mechanisms.\n\n    -   **Strengths:** Although less updated and less comprehensive than other databases mentioned, BioCarta pathways have been historically significant for offering insights into specific signaling and molecular pathways, contributing to the understanding of complex biological processes.\n\n## Visualization of GSEA\n\n#### Setup\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nhere() starts at C:/Users/alosvendsen/Documents/R/manuscript\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(readxl)\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.3     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n✔ purrr     1.0.2     \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(patchwork)\n```\n:::\n\n\n### IL-1B 10 ng\n\n#### KEGG\n\nTesting just KEGG. Getting the code to work for one file.\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\npath_raw_data <- here(\"notebooks/seq/data_raw/GSEA/\")\ngsea_data <- read_excel(here(path_raw_data, \"KEGG_IL1B_10_vs_vehicle.xlsx\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nplot_data <- \n  arrange(gsea_data, -abs(NES)) %>% \n    group_by(sign(NES)) %>%\n    slice(1:20)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nggplot(data = plot_data,\n       aes(x = NES,\n           y = fct_reorder(pathway, NES),\n           fill = padj\n           )\n       ) +\n  geom_bar(stat = \"identity\") +\n  scale_fill_distiller(type = \"seq\", palette = \"YlOrRd\")\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/unnamed-chunk-4-1.png){width=1152}\n:::\n\n```{.r .cell-code .hidden}\n  #scale_fill_continuous(low='red', high='blue', guide=guide_colorbar(reverse=TRUE), ) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nggplot(plot_data, aes(x = NES, y = fct_reorder(pathway, NES), color = padj, size = size)) + \n  geom_point(stat = 'identity') + \n  xlab(\"ratio\") + ylab(\"path\") + ggtitle(\"your data\") + \n  theme_bw() + \n  scale_color_viridis_c() +\n  #scale_color_distiller(type = \"seq\", palette = \"PuRd\") +\n  geom_vline(xintercept = 0)\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/unnamed-chunk-5-1.png){width=1152}\n:::\n:::\n\n\n\n### All KEGG plots\n\nPlot all using a function\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# Get file paths\nkegg_file_paths <- dir(here(\"notebooks/seq/data_raw/GSEA\"), pattern = \"KEGG\", full.names = TRUE)\n\n# Subset to interleukines if wanted\n#kegg_file_paths[grep(pattern = \"IL\", kegg_file_paths)]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nKEGG_plot_list <- map(kegg_file_paths, function(file_path) {\n  # Read the file\n  plot_data <- read_excel(file_path)\n  \n  # Process the data\n  processed_data <- plot_data %>%\n    arrange(desc(abs(NES))) %>%\n    group_by(sign_NES = sign(NES)) %>%\n    slice_head(n = 10) %>%\n    ungroup() %>%\n    filter(padj <= 0.05) %>%\n    mutate(pathway = str_remove_all(pathway, \"KEGG_\"),\n           pathway = str_replace_all(pathway, pattern = \"_\", replacement = \" \"),\n           pathway = str_to_title(pathway))\n\n  \n  # Generate the plot\n  ggplot(processed_data,\n         aes(x = NES,\n             y = fct_reorder(pathway, NES),\n             color = padj,\n             size = size\n             )\n         ) +\n    geom_point(stat = 'identity') +\n    labs(x = \"NES\",\n         y = \"Pathway\",\n         title = paste(\"Top 10 up/down Pathways for\",\"\", basename(file_path))\n         ) +\n    theme_bw() +\n    geom_vline(xintercept = 0) +\n    scale_color_viridis_c()\n    #scale_color_distiller(type = \"seq\", palette = \"YlOrRd\") #+\n    #theme(axis.text.y = element_text(size = 8))\n})\n```\n:::\n\n::: {#cell-fig-kegg-abe .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-kegg-abe\n\nKEGG_plot_list[[1]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-kegg-abe-1.png){#fig-kegg-abe width=1152}\n:::\n:::\n\n::: {#cell-fig-kegg-il1b-0.1 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-kegg-il1b-0.1\n\nKEGG_plot_list[[2]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-kegg-il1b-0.1-1.png){#fig-kegg-il1b-0.1 width=1152}\n:::\n:::\n\n::: {#cell-fig-kegg-il1b-10 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-kegg-il1b-10\n\nKEGG_plot_list[[3]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-kegg-il1b-10-1.png){#fig-kegg-il1b-10 width=1152}\n:::\n:::\n\n::: {#cell-fig-kegg-il6-0.1 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-kegg-il6-0.1\n\nKEGG_plot_list[[4]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-kegg-il6-0.1-1.png){#fig-kegg-il6-0.1 width=1152}\n:::\n:::\n\n::: {#cell-fig-kegg-il6-10 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-kegg-il6-10\n\nKEGG_plot_list[[5]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-kegg-il6-10-1.png){#fig-kegg-il6-10 width=1152}\n:::\n:::\n\n::: {#cell-fig-kegg-il6-combined .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-kegg-il6-combined\n\nKEGG_plot_list[[6]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-kegg-il6-combined-1.png){#fig-kegg-il6-combined width=1152}\n:::\n:::\n\n::: {#cell-fig-kegg-medium .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-kegg-medium\n\nKEGG_plot_list[[7]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-kegg-medium-1.png){#fig-kegg-medium width=1152}\n:::\n:::\n\n::: {#cell-fig-kegg-rif .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-kegg-rif\n\nKEGG_plot_list[[8]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-kegg-rif-1.png){#fig-kegg-rif width=1152}\n:::\n:::\n\n\n#### ALL BIOCARTA\n\n**Plot all using a function**\n\nGet all file paths related to BIOCARTA\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# Get file paths\nbiocarta_file_paths <- dir(here(\"notebooks/seq/data_raw/GSEA\"), pattern = \"BIOCARTA\", full.names = TRUE)\n\n# Subset to interleukines if wanted\n# kegg_file_paths[grep(pattern = \"IL\", kegg_file_paths)]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nBIOCARTA_plot_list <- map(biocarta_file_paths, function(file_path) {\n  # Read the file\n  plot_data <- read_excel(file_path)\n  \n  # Process the data\n  processed_data <- plot_data %>%\n    arrange(desc(abs(NES))) %>%\n    group_by(sign_NES = sign(NES)) %>%\n    slice_head(n = 10) %>%\n    ungroup() %>%\n    filter(padj <= 0.05) %>%\n    mutate(pathway = str_remove_all(pathway, \"BIOCARTA\"),\n           pathway = str_replace_all(pathway, pattern = \"_\", replacement = \" \"),\n           pathway = str_to_title(pathway))\n  \n  # Generate the plot\n  ggplot(processed_data, aes(x = NES, y = fct_reorder(pathway, NES), color = padj, size = size)) +\n    geom_point(stat = 'identity') +\n    labs(x = \"NES\", y = \"Pathway\", title = paste(\"Top 10 up/down Pathways for\",\"\", basename(file_path))) +\n    theme_bw() +\n    geom_vline(xintercept = 0) +\n    scale_color_viridis_c()\n    #scale_color_distiller(type = \"seq\", palette = \"YlOrRd\") #+\n    #theme(legend.position = \"none\") # Remove legend to focus on the data\n})\n```\n:::\n\n::: {#cell-fig-biocarta-abe .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-biocarta-abe\nBIOCARTA_plot_list[[1]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-biocarta-abe-1.png){#fig-biocarta-abe width=1152}\n:::\n:::\n\n::: {#cell-fig-biocarta-il1b-0.1 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-biocarta-il1b-0.1\nBIOCARTA_plot_list[[2]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-biocarta-il1b-0.1-1.png){#fig-biocarta-il1b-0.1 width=1152}\n:::\n:::\n\n::: {#cell-fig-biocarta-il1b-10 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-biocarta-il1b-10\nBIOCARTA_plot_list[[3]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-biocarta-il1b-10-1.png){#fig-biocarta-il1b-10 width=1152}\n:::\n:::\n\n::: {#cell-fig-biocarta-il6-0.1 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-biocarta-il6-0.1\nBIOCARTA_plot_list[[4]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-biocarta-il6-0.1-1.png){#fig-biocarta-il6-0.1 width=1152}\n:::\n:::\n\n::: {#cell-fig-biocarta-il6-10 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-biocarta-il6-10\nBIOCARTA_plot_list[[5]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-biocarta-il6-10-1.png){#fig-biocarta-il6-10 width=1152}\n:::\n:::\n\n::: {#cell-fig-biocarta-il6-combined .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-biocarta-il6-combined\nBIOCARTA_plot_list[[6]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-biocarta-il6-combined-1.png){#fig-biocarta-il6-combined width=1152}\n:::\n:::\n\n::: {#cell-fig-biocarta-medium .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-biocarta-medium\nBIOCARTA_plot_list[[7]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-biocarta-medium-1.png){#fig-biocarta-medium width=1152}\n:::\n:::\n\n::: {#cell-fig-biocarta-rif .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-biocarta-rif\nBIOCARTA_plot_list[[8]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-biocarta-rif-1.png){#fig-biocarta-rif width=1152}\n:::\n:::\n\n\n### REACTOME\n\nGet all file paths related to Reactome\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# Get file paths\nreactome_file_paths <- dir(here(\"notebooks/seq/data_raw/GSEA\"), pattern = \"REACTOME\", full.names = TRUE)\n\n# Subset to interleukines if wanted\n# kegg_file_paths[grep(pattern = \"IL\", kegg_file_paths)]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nREACTOME_plot_list <- map(reactome_file_paths, function(file_path) {\n  # Read the file\n  plot_data <- read_excel(file_path)\n  \n  # Process the data\n  processed_data <- plot_data %>%\n    arrange(desc(abs(NES))) %>%\n    group_by(sign_NES = sign(NES)) %>%\n    slice_head(n = 10) %>%\n    ungroup() %>%\n    filter(padj <= 0.05) %>%\n    mutate(pathway = str_remove_all(pathway, \"REACTOME_\"),\n           pathway = str_replace_all(pathway, pattern = \"_\", replacement = \" \"),\n           pathway = str_to_title(pathway))\n  \n  # Generate the plot\n  ggplot(processed_data,\n         aes(x = NES,\n             y = fct_reorder(pathway, NES),\n             color = padj,\n             size = size\n             )\n         ) +\n    geom_point(stat = 'identity') +\n    labs(x = \"NES\",\n         y = \"Pathway\",\n         title = paste(\"Top 10 up/down Pathways for\",\"\", basename(file_path))\n         ) +\n    theme_bw() +\n    geom_vline(xintercept = 0) +\n    scale_color_viridis_c() \n    #scale_color_distiller(type = \"seq\", palette = \"YlOrRd\") #+\n    #theme(legend.position = \"none\") # Remove legend to focus on the data\n})\n```\n:::\n\n::: {#cell-fig-reactome-abe .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-reactome-abe\n\nREACTOME_plot_list[[1]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-reactome-abe-1.png){#fig-reactome-abe width=1152}\n:::\n:::\n\n::: {#cell-fig-reactome-il1b-0.1 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-reactome-il1b-0.1\n\nREACTOME_plot_list[[2]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-reactome-il1b-0.1-1.png){#fig-reactome-il1b-0.1 width=1152}\n:::\n:::\n\n::: {#cell-fig-reactome-il1b-10 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-reactome-il1b-10\n\nREACTOME_plot_list[[3]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-reactome-il1b-10-1.png){#fig-reactome-il1b-10 width=1152}\n:::\n:::\n\n::: {#cell-fig-reactome-il6-0.1 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-reactome-il6-0.1\n\nREACTOME_plot_list[[4]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-reactome-il6-0.1-1.png){#fig-reactome-il6-0.1 width=1152}\n:::\n:::\n\n::: {#cell-fig-reactome-il6-10 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-reactome-il6-10\n\nREACTOME_plot_list[[5]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-reactome-il6-10-1.png){#fig-reactome-il6-10 width=1152}\n:::\n:::\n\n::: {#cell-fig-reactome-il6-combined .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-reactome-il6-combined\n\nREACTOME_plot_list[[6]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-reactome-il6-combined-1.png){#fig-reactome-il6-combined width=1152}\n:::\n:::\n\n::: {#cell-fig-reactome-medium .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-reactome-medium\n\nREACTOME_plot_list[[7]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-reactome-medium-1.png){#fig-reactome-medium width=1152}\n:::\n:::\n\n::: {#cell-fig-reactome-rif .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-reactome-rif\n\nREACTOME_plot_list[[8]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-reactome-rif-1.png){#fig-reactome-rif width=1152}\n:::\n:::\n\n\n### GO combined databases\n\nCONSIDER :Split data into each of the GO databases:\n\n1.  **Biological Process (BP)**, which describes the biological objectives to which the gene or gene product contributes.\n2.  **Molecular Function (MF**), which describes the elemental activities of a gene product at the molecular level, such as binding or catalysis.\n3.  **Cellular Component (CC)**, which describes where in the cell the gene product is active.\n\nGet all file paths related to GO\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# Get file paths\ngo_file_paths <- dir(here(\"notebooks/seq/data_raw/GSEA\"), pattern = \"GO\", full.names = TRUE)\n\n# Subset to interleukines if wanted\n# kegg_file_paths[grep(pattern = \"IL\", kegg_file_paths)]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nGO_plot_list <- map(go_file_paths, function(file_path) {\n  # Read the file\n  plot_data <- read_excel(file_path)\n  \n  # Process the data\n  processed_data <- plot_data %>%\n    arrange(desc(abs(NES))) %>%\n    group_by(sign_NES = sign(NES)) %>%\n    slice_head(n = 10) %>%\n    ungroup() %>%\n    filter(padj <= 0.05)\n  \n  # Generate the plot\n  ggplot(processed_data,\n         aes(x = NES,\n             y = fct_reorder(pathway, NES),\n             color = padj,\n             size = size\n             )\n         ) +\n    geom_point(stat = 'identity') +\n    labs(x = \"NES\",\n         y = \"Pathway\",\n         title = paste(\"Top 10 up/down Pathways for\",\"\", basename(file_path))\n         ) +\n    theme_bw() +\n    geom_vline(xintercept = 0) +\n    scale_color_viridis_c() \n    #scale_color_viridis_c(option = \"A\")\n    #scale_color_distiller(type = \"seq\", palette = \"YlOrRd\") #+\n    #theme(legend.position = \"none\") # Remove legend to focus on the data\n})\n```\n:::\n\n::: {#cell-fig-go-abe .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-go-abe\n\nGO_plot_list[[1]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-go-abe-1.png){#fig-go-abe width=1152}\n:::\n:::\n\n::: {#cell-fig-go-il1b-0.1 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-go-il1b-0.1\n\nGO_plot_list[[2]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-go-il1b-0.1-1.png){#fig-go-il1b-0.1 width=1152}\n:::\n:::\n\n::: {#cell-fig-go-il1b-10 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-go-il1b-10\n\nGO_plot_list[[3]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-go-il1b-10-1.png){#fig-go-il1b-10 width=1152}\n:::\n:::\n\n::: {#cell-fig-go-il6-0.1 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-go-il6-0.1\n\nGO_plot_list[[4]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-go-il6-0.1-1.png){#fig-go-il6-0.1 width=1152}\n:::\n:::\n\n::: {#cell-fig-go-il6-10 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-go-il6-10\n\nGO_plot_list[[5]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-go-il6-10-1.png){#fig-go-il6-10 width=1152}\n:::\n:::\n\n::: {#cell-fig-go-plots6 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-go-plots6\n#| fig-width: 12\n#| fig-height: 10\n\nGO_plot_list[[6]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-go-plots6-1.png){#fig-go-plots6 width=1152}\n:::\n:::\n\n::: {#cell-fig-go-medium .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-go-medium\n#| fig-width: 12\n#| fig-height: 10\n\nGO_plot_list[[7]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-go-medium-1.png){#fig-go-medium width=1152}\n:::\n:::\n\n::: {#cell-fig-go-rif .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-go-rif\n#| fig-width: 12\n#| fig-height: 10\n\nGO_plot_list[[8]]\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-go-rif-1.png){#fig-go-rif width=1152}\n:::\n:::\n\n\n### GO split databases\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# Read the GO file paths, and for each dataframe, add a column denoting \n# Which GO database was used.\nGO_sorted_dfs <- map(go_file_paths, function(path) {\n  read_excel(path) %>%\n    mutate(db = case_when(\n      str_detect(pathway, \"GOBP\") ~ \"BP\",\n      str_detect(pathway, \"GOCC\") ~ \"CC\",\n      str_detect(pathway, \"GOMF\") ~ \"MF\"\n    ))\n})\n\n# Process the dataframes. Arrange by absolute NES vaule, group on positive or \n# negative regulation. Take just top ten of each group, and filter in only stat\n# significant pathways.\nGO_processed_data <- map(GO_sorted_dfs, function(df) {\n    df %>%\n    arrange(desc(abs(NES))) %>%\n    group_by(sign_NES = sign(NES)) %>%\n    slice_head(n = 10) %>%\n    ungroup() %>%\n    filter(padj <= 0.05)\n})\n\n\n# Function to generate plots for each db category within a single dataframe\ngenerate_plots <- function(df, file_path) {\n  db_categories <- unique(df$db)\n  plots <- map(db_categories, function(db_category) {\n    filtered_data <- filter(df, db == db_category)\n    plot <- ggplot(filtered_data,\n                   aes(x = NES,\n                       y = fct_reorder(pathway, NES),\n                       color = padj,\n                       size = size)) +\n      geom_point(stat = 'identity') +\n      labs(x = \"NES\",\n           y = \"Pathway\",\n           title = paste(\"Top 10 up/down Pathways for\", db_category, basename(file_path))) +\n      theme_bw() +\n      geom_vline(xintercept = 0) +\n      scale_color_viridis_c()\n    plot\n  })\n  names(plots) <- db_categories\n  return(plots)\n}\n\n# Map over GO_processed_data to generate plots for each dataframe\nGO_plots <- map2(GO_processed_data, go_file_paths, generate_plots)\n\n# GO_plots is a list of lists of plots, with each inner list containing three plots (one for each db category)\n\n\n# Extracting treatment names from the file paths\n# Assuming the treatment names are directly before \"vs_vehicle.xlsx\" in the file names\ntreatment_names <- sapply(go_file_paths, function(path) {\n  # Extract the part of the filename before \"vs_vehicle.xlsx\"\n  treatment_name <- sub(\".*GO_(.*)_vs_vehicle\\\\.xlsx$\", \"\\\\1\", basename(path))\n  # Replace underscores with spaces or any other necessary formatting\n  treatment_name <- gsub(\"_\", \" \", treatment_name)\n  treatment_name\n})\n\n# Now, apply these names to your combined_GO_plots list\nnames(GO_plots) <- treatment_names\n```\n:::\n\n::: {#cell-fig-go-split-il1b-0.1 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-go-split-il1b-0.1\n\n# Combine plots from each database\ncombined_plot <- GO_plots[[2]]$BP + GO_plots[[2]]$CC + GO_plots[[2]]$MF + \n  plot_layout(ncol = 1) # Arranges the plots in a single column\n\n# Print the combined plot\nprint(combined_plot)\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-go-split-il1b-0.1-1.png){#fig-go-split-il1b-0.1 width=1152}\n:::\n:::\n\n::: {#cell-fig-go-split-il1b-10 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-go-split-il1b-10\n#| fig-width: 20\n\n# Combine plots from each database\ncombined_plot <- GO_plots[[3]]$BP + GO_plots[[3]]$CC + GO_plots[[3]]$MF + \n  plot_layout(ncol = 1) # Arranges the plots in a single column\n\n# Print the combined plot\nprint(combined_plot)\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-go-split-il1b-10-1.png){#fig-go-split-il1b-10 width=1920}\n:::\n:::\n\n::: {#cell-fig-go-split-i6-0.1 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-go-split-i6-0.1\n\n# Combine plots from each database\ncombined_plot <- GO_plots[[4]]$BP + GO_plots[[4]]$CC + GO_plots[[4]]$MF + \n  plot_layout(ncol = 1) # Arranges the plots in a single column\n\n# Print the combined plot\nprint(combined_plot)\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-go-split-i6-0.1-1.png){#fig-go-split-i6-0.1 width=1152}\n:::\n:::\n\n::: {#cell-fig-go-split-i6-10 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-go-split-i6-10\n\n# Combine plots from each database\ncombined_plot <- GO_plots[[5]]$BP + GO_plots[[5]]$CC + GO_plots[[5]]$MF + \n  plot_layout(ncol = 1) # Arranges the plots in a single column\n\n# Print the combined plot\nprint(combined_plot)\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-go-split-i6-10-1.png){#fig-go-split-i6-10 width=1152}\n:::\n:::\n\n::: {#cell-fig-go-split-i6-combined .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-go-split-i6-combined\n\n# Combine plots from each database\ncombined_plot <- GO_plots[[6]]$BP + GO_plots[[6]]$CC + GO_plots[[6]]$MF + \n  plot_layout(ncol = 1) # Arranges the plots in a single column\n\n# Print the combined plot\nprint(combined_plot)\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-go-split-i6-combined-1.png){#fig-go-split-i6-combined width=1152}\n:::\n:::\n\n::: {#cell-fig-go-split-medium .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-go-split-medium\n\n# Combine plots from each database\ncombined_plot <- GO_plots[[7]]$BP + GO_plots[[7]]$CC + GO_plots[[7]]$MF + \n  plot_layout(ncol = 1) # Arranges the plots in a single column\n\n# Print the combined plot\nprint(combined_plot)\n```\n\n::: {.cell-output-display}\n![](GSEA_files/figure-html/fig-go-split-medium-1.png){#fig-go-split-medium width=1152}\n:::\n:::\n",
    "supporting": [
      "GSEA_files\\figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
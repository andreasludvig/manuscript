{
  "hash": "877306925b3fa510234e90d7cd2c6479",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: LCMS\n---\n\n\n\n\n\n\n## Setup\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlibrary(data.table)\nlibrary(ggplot2)\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nhere() starts at C:/Users/alosvendsen/Documents/R/manuscript\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(RColorBrewer)\n```\n:::\n\n\n\n\n\n\n\n## Donor 3, AS0013B, Midazolam\n### Peak status'\nCheck peak status' for any amounts below what below/above the limit of our standard curve.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# Load data\ndonor_3_peak_status <- \n  readRDS(here(\"notebooks/LCMS/data_processed/AS0013_peak_status.rds\"))\n\ndonor_3_peak_status\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   sample_name     amount  peak_status       metabolite donor     treatment\n1: AS0013B_113 0.08809692 Response Low Hydroxymidazolam     3 10 ng/ml IL-6\n   time_treatment time_incubation rep\n1:            120             0.5   1\n```\n\n\n:::\n:::\n\n\n\n\n\n**Should this be omitted? It is below the lowest point on our standard curve, but omitting it would make the mean higher, than it really is? For now it is included in calculated means.**\n\n\n### **Plots**\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# Load processed data\ndonor_3_data <- \n  readRDS(here(\"notebooks/LCMS/data_processed/AS0013.rds\"))\n\n\n# Create groups/look up tables for subsetting data\ngroup_IL6 <- c(#\"control\", \n               #\"medium\", \n               \"0.01 ng/ml IL-6\", \n               \"0.1 ng/ml IL-6\",\n               \"1 ng/ml IL-6\", \n               \"10 ng/ml IL-6\"\n               )\n\ngroup_IL1B <- c(#\"control\", \n                #\"medium\", \n                \"0.01 ng/ml IL-1B\", \n                \"0.1 ng/ml IL-1B\",\n                \"1 ng/ml IL-1B\",\n                \"10 ng/ml IL-1B\"\n                )\n```\n:::\n\n\n\n\n\n\nIL-6 effect on CYP3A4\n\n\n\n\n\n::: {#cell-fig-act_3A4_IL_6_AS0013 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-act_3A4_IL_6_AS0013\n#| fig-cap: \"Donor 3: Activity, IL-6\"\n\nplot_data <- \n  donor_3_data[time_incubation == 0.5 \n               & treatment %in% group_IL6\n               ]\n\n\nact_3A4_IL_6_AS0013 <- \n  ggplot(data = plot_data) +\n  geom_point(aes(x = treatment,\n                 y = mean_relative_amount,\n                 color = factor(time_treatment)\n                 ),\n             size = 8,\n             alpha = 0.7,\n             ) +\n  scale_color_brewer(palette = \"Set2\") +\n  geom_point(aes(x = treatment,\n                 y = relative_amount\n                 ),\n             size = 4,\n             alpha = 0.3\n             ) +\n  geom_hline(yintercept = 1, linetype = \"dashed\") +\n  scale_y_continuous(\n    name = \"OH-midazolam formation relative to vehicle control\", \n    breaks = seq(from = 0, to = 3, by= 0.25)\n    ) +\n  facet_wrap(\n    facets = vars(factor(time_treatment))\n    ) +\n  theme_bw() +\n  xlab(\"Treatment\") + \n  ggtitle(\"CYP3A4 activity after treatment with IL-6: Donor 3\",\n          subtitle = \"Facetted on treatment duration in hours\"\n          ) +\n  ylab(\"Metabolite formation relative to vehicle control\") +\n  theme(axis.text.x = element_text(size = 10, angle = 45, hjust = 1),\n        axis.title.x = element_text(hjust = 0.5, vjust = 0, face = \"bold\"),\n        axis.title.y = element_text(face = \"bold\"),\n        legend.position = \"none\"\n        )\n\n\nact_3A4_IL_6_AS0013\n\n# ggsave(\n#   plot = last_plot(),\n#   filename = \"3A4_IL_6_AS0013.png\",\n#   device = \"png\",\n#   path = here(\"notebooks/LCMS/output\")\n#   )\n```\n\n::: {.cell-output-display}\n![Donor 3: Activity, IL-6](LCMS_files/figure-html/fig-act_3A4_IL_6_AS0013-1.png){#fig-act_3A4_IL_6_AS0013 width=672}\n:::\n:::\n\n\n\n\n\n\nIL-1B effect on CYP3A4\n\n\n\n\n\n::: {#cell-fig-act_3A4_IL_1B_AS0013 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-act_3A4_IL_1B_AS0013\n#| fig-cap: \"Donor 3: Activity, IL-1B\"\n\nplot_data <- \n  donor_3_data[time_incubation == 0.5 &\n                 treatment %in% group_IL1B\n               ]\n\nact_3A4_IL_1B_AS0013 <-\n  ggplot(data = plot_data) +\n  geom_point(aes(x = treatment,\n                 y = mean_relative_amount,\n                 color = factor(time_treatment)\n                 ),\n             size = 8,\n             alpha = 0.7\n             ) +\n  scale_color_brewer(palette = \"Set2\") +\n  geom_point(aes(x = treatment,\n                 y = relative_amount\n                 ),\n             size = 4,\n             alpha = 0.3\n             ) +\n  geom_hline(yintercept = 1, linetype = \"dashed\") +\n  scale_y_continuous(\n    name = \"OH-midazolam formation relative to vehicle control\", \n    breaks = seq(from = 0, to = 3, by= 0.25)\n    ) +\n  facet_wrap(\n    facets = vars(factor(time_treatment))\n  ) +\n  theme_bw() +\n  xlab(\"Treatment\") + \n  ggtitle(\"CYP3A4 activity after treatment with IL-1B: Donor 3\",\n          subtitle = \"Facetted on treatment duration in hours\") +\n  ylab(\"Metabolite formation relative to vehicle control\") +\n  theme(axis.text.x = element_text(size = 10, angle = 45, hjust = 1),\n        axis.title.x = element_text(hjust = 0.5, vjust = 0, face = \"bold\"),\n        axis.title.y = element_text(face = \"bold\"),\n        legend.position = \"none\"\n  )\n\nact_3A4_IL_1B_AS0013\n\n# ggsave(\n#   plot = last_plot(),\n#   filename = \"3A4_IL_1B_AS0013.png\",\n#   device = \"png\",\n#   path = here(\"notebooks/LCMS/output\")\n#   )\n```\n\n::: {.cell-output-display}\n![Donor 3: Activity, IL-1B](LCMS_files/figure-html/fig-act_3A4_IL_1B_AS0013-1.png){#fig-act_3A4_IL_1B_AS0013 width=672}\n:::\n:::\n\n\n\n\n\n\n## Donor 2, AS0008, midazolam\nLoad data\nCheck peak status' for any amounts below what below/above the limit of our standard curve.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ndonor_2_peak_status <- \n  readRDS(here(\"notebooks/LCMS/data_processed/AS0008_peak_status.rds\"))\n\n# Check peak status'\ndonor_2_peak_status |> knitr::kable()\n```\n\n::: {.cell-output-display}\n\n\n|sample_name |     amount|peak_status  |metabolite       | donor|treatment       |time_treatment | time_incubation| rep|\n|:-----------|----------:|:------------|:----------------|-----:|:---------------|:--------------|---------------:|---:|\n|AS0008_135  |  0.9118640|Response Low |Hydroxymidazolam |     2|10 ng/ml IL-6   |72             |             0.5|   3|\n|AS0008_152  |         NA|Not Found    |Hydroxymidazolam |     2|1 ng/ml IL-1B   |72             |             8.0|   1|\n|AS0008_153  |         NA|Not Found    |Hydroxymidazolam |     2|10 ng/ml IL-1B  |72             |             8.0|   1|\n|AS0008_162  |         NA|Not Found    |Hydroxymidazolam |     2|1 ng/ml IL-1B   |72             |             8.0|   2|\n|AS0008_163  |         NA|Not Found    |Hydroxymidazolam |     2|10 ng/ml IL-1B  |72             |             8.0|   2|\n|AS0008_171  | -0.2901863|Response Low |Hydroxymidazolam |     2|0.1 ng/ml IL-1B |72             |             8.0|   3|\n|AS0008_172  |         NA|Not Found    |Hydroxymidazolam |     2|1 ng/ml IL-1B   |72             |             8.0|   3|\n|AS0008_173  |         NA|Not Found    |Hydroxymidazolam |     2|10 ng/ml IL-1B  |72             |             8.0|   3|\n|AS0008_197  |  0.8381536|Response Low |Hydroxymidazolam |     2|10 ng/ml IL-6   |120            |             0.5|   1|\n\n\n:::\n:::\n\n\n\n\n\nSamples 52, 153, 162, 163, 172, and 173 had no baselcocktail added to there wells, and that is why there is no peaks. Sample 171 did not have a spheroid in the well. These samples are removed from the datatable before calculating means. However, there are two samples left with \"response low\", which are included in calculating means. \n\n\n\n### **Plots**\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# Load processed data\ndonor_2_data <- \n  readRDS(here(\"notebooks/LCMS/data_processed/AS0008.rds\"))\n\n\n# Create groups/look up tables for subsetting data\ngroup_IL6 <- c(#\"control\", \n               #\"medium\", \n               \"0.01 ng/ml IL-6\", \n               \"0.1 ng/ml IL-6\",\n               \"1 ng/ml IL-6\", \n               \"10 ng/ml IL-6\"\n               )\n\ngroup_IL1B <- c(#\"control\", \n                #\"medium\", \n                \"0.01 ng/ml IL-1B\", \n                \"0.1 ng/ml IL-1B\",\n                \"1 ng/ml IL-1B\",\n                \"10 ng/ml IL-1B\"\n                )\n```\n:::\n\n\n\n\n\n\nIL-6 effect on CYP3A4\n\n\n\n\n\n::: {#cell-fig-act_3A4_IL_6_AS0008 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-act_3A4_IL_6_AS0008\n#| fig-cap: \"Donor 2: Activity, IL-6\"\n\nplot_data <- \n  donor_2_data[time_incubation == 0.5 \n               & treatment %in% group_IL6\n               ]\n\n\nact_3A4_IL_6_AS0008 <- \n  ggplot(data = plot_data) +\n  geom_point(aes(x = treatment,\n                 y = mean_relative_amount,\n                 color = factor(time_treatment)\n                 ),\n             size = 8,\n             alpha = 0.7,\n             ) +\n  scale_color_brewer(palette = \"Set2\") +\n  geom_point(aes(x = treatment,\n                 y = relative_amount\n                 ),\n             size = 4,\n             alpha = 0.3\n             ) +\n  geom_hline(yintercept = 1, linetype = \"dashed\") +\n  scale_y_continuous(\n    name = \"OH-midazolam formation relative to vehicle control\", \n    breaks = seq(from = 0, to = 3, by= 0.25)\n    ) +\n  facet_wrap(\n    facets = vars(factor(time_treatment))\n    ) +\n  theme_bw() +\n  xlab(\"Treatment\") + \n  ggtitle(\"CYP3A4 activity after treatment with IL-6: Donor 2\",\n          subtitle = \"Facetted on treatment duration in hours\"\n          ) +\n  ylab(\"Metabolite formation relative to vehicle control\") +\n  theme(axis.text.x = element_text(size = 10, angle = 45, hjust = 1),\n        axis.title.x = element_text(hjust = 0.5, vjust = 0, face = \"bold\"),\n        axis.title.y = element_text(face = \"bold\"),\n        legend.position = \"none\"\n        )\n\n\nact_3A4_IL_6_AS0008\n\n# ggsave(\n#   plot = last_plot(),\n#   filename = \"3A4_IL_6_AS0008.png\",\n#   device = \"png\",\n#   path = here(\"notebooks/LCMS/output\")\n#   )\n```\n\n::: {.cell-output-display}\n![Donor 2: Activity, IL-6](LCMS_files/figure-html/fig-act_3A4_IL_6_AS0008-1.png){#fig-act_3A4_IL_6_AS0008 width=672}\n:::\n:::\n\n\n\n\n\n\nIL-1B effect on CYP3A4\n\n\n\n\n\n::: {#cell-fig-act_3A4_IL_1B_AS0008 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-act_3A4_IL_1B_AS0008\n#| fig-cap: \"Donor 2: Activity, IL-1B\"\n\nplot_data <- \n  donor_2_data[time_incubation == 0.5 &\n                 treatment %in% group_IL1B\n               ]\n\nact_3A4_IL_1B_AS0008 <-\n  ggplot(data = plot_data) +\n  geom_point(aes(x = treatment,\n                 y = mean_relative_amount,\n                 color = factor(time_treatment)\n                 ),\n             size = 8,\n             alpha = 0.7\n             ) +\n  scale_color_brewer(palette = \"Set2\") +\n  geom_point(aes(x = treatment,\n                 y = relative_amount\n                 ),\n             size = 4,\n             alpha = 0.3\n             ) +\n  geom_hline(yintercept = 1, linetype = \"dashed\") +\n  scale_y_continuous(\n    name = \"OH-midazolam formation relative to vehicle control\", \n    breaks = seq(from = 0, to = 3, by= 0.25)\n    ) +\n  facet_wrap(\n    facets = vars(factor(time_treatment))\n  ) +\n  theme_bw() +\n  xlab(\"Treatment\") + \n  ggtitle(\"CYP3A4 activity after treatment with IL-1B: Donor 2\",\n          subtitle = \"Facetted on treatment duration in hours\") +\n  ylab(\"Metabolite formation relative to vehicle control\") +\n  theme(axis.text.x = element_text(size = 10, angle = 45, hjust = 1),\n        axis.title.x = element_text(hjust = 0.5, vjust = 0, face = \"bold\"),\n        axis.title.y = element_text(face = \"bold\"),\n        legend.position = \"none\"\n  )\n\nact_3A4_IL_1B_AS0008\n\n# ggsave(\n#   plot = last_plot(),\n#   filename = \"3A4_IL_1B_AS0008.png\",\n#   device = \"png\",\n#   path = here(\"notebooks/LCMS/output\")\n#   )\n```\n\n::: {.cell-output-display}\n![Donor 2: Activity, IL-1B](LCMS_files/figure-html/fig-act_3A4_IL_1B_AS0008-1.png){#fig-act_3A4_IL_1B_AS0008 width=672}\n:::\n:::\n\n\n\n\n\n\n\n## Main plots\n\nload data\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ndata <- readRDS(here(\"notebooks/LCMS/data_processed/final_data.rds\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# Create groups/look up tables for subsetting data\ngroup_IL6 <- c(#\"control\", \n               #\"medium\", \n               \"0.01 ng/ml IL-6\", \n               \"0.1 ng/ml IL-6\",\n               \"1 ng/ml IL-6\", \n               \"10 ng/ml IL-6\"\n               )\n\ngroup_IL1B <- c(#\"control\", \n                #\"medium\", \n                \"0.01 ng/ml IL-1B\", \n                \"0.1 ng/ml IL-1B\",\n                \"1 ng/ml IL-1B\",\n                \"10 ng/ml IL-1B\"\n                )\n```\n:::\n\n\n\n\n\n\n\n### Facetted on time \nIL-6\n\n\n\n\n\n::: {#cell-fig-act-cyp3A4-IL6 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-act-cyp3A4-IL6\n#| fig-cap: \"Mean CYP3A4 activity relative to vehicle control after IL-6 treatment. Facetted on time. 24 hour timepoints removed\"\n#| fig-width: 10\n#| fig-height: 5\n\nplot_data_IL6 <- data[time_incubation == 0.5 \n                      & treatment %in% group_IL6\n                      & time_treatment != 24]\n\n\nact_3A4_IL6 <- ggplot(data = plot_data_IL6) +\n  geom_point(\n    mapping = aes(x = treatment, y = mean_relative_amount, color = factor(time_treatment)),\n    size = 3.5\n  ) +\n  stat_summary(\n    fun = \"mean\",\n    geom = \"point\",\n    mapping = aes(x = treatment, y = mean_relative_amount),\n    size = 5\n  ) +\n  scale_color_brewer(palette = \"Set2\") +\n  facet_wrap(~ time_treatment, ) +\n  labs(title = \"CYP3A4 activity relative to vehicle control after IL-6 treatment\",\n       x = \"Treatment\",\n       y = \"Expression relative to vehicle control\",\n       color = \"Treatment duration\") + \n  scale_y_continuous(limits = c(0, NA)) +\n  theme_bw() +\n  theme(axis.text.x = element_text(angle = 30, hjust = 1),\n        axis.title.y = element_text(vjust = 3, face = \"bold\"),\n        axis.title.x = element_text(vjust = -1.5, face =\"bold\"),\n        plot.title = element_text(face = \"bold\"),\n        legend.title = element_text(face = \"bold\"),\n        legend.position = \"bottom\"\n     ) +\n  geom_hline(yintercept = 1, linetype = \"dashed\")\n\n\n\nact_3A4_IL6\n```\n\n::: {.cell-output-display}\n![Mean CYP3A4 activity relative to vehicle control after IL-6 treatment. Facetted on time. 24 hour timepoints removed](LCMS_files/figure-html/fig-act-cyp3A4-IL6-1.png){#fig-act-cyp3A4-IL6 width=960}\n:::\n:::\n\n\n\n\n\nCONSIDER REMOVING THE OUTLIER IN 120 hour IL-6 and IL1B. See the individual plots above.\n\n\nIL-1B\n\n\n\n\n\n::: {#cell-fig-act-cyp3A4-IL1B .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-act-cyp3A4-IL1B\n#| fig-cap: \"Mean CYP3A4 activity relative to vehicle control after IL-1B treatment. Facetted on time. 24 hour timepoints removed\"\n#| fig-width: 10\n#| fig-height: 5\n\nplot_data_I1B <- data[time_incubation == 0.5 \n                      & treatment %in% group_IL1B\n                      & time_treatment != 24]\n\n\nact_3A4_IL1B <- \n  ggplot(data = plot_data_I1B) +\n    geom_point(\n      mapping = aes(x = treatment, y = mean_relative_amount, color = factor(time_treatment)),\n      size = 3.5\n    ) +\n    stat_summary(\n      fun = \"mean\",\n      geom = \"point\",\n      mapping = aes(x = treatment, y = mean_relative_amount),\n      size = 5\n    ) +\n    scale_color_brewer(palette = \"Set2\") +\n    facet_wrap(facets = vars(time_treatment)) +\n    labs(title = \"CYP3A4 activity relative to vehicle control after IL-1B treatment\",\n         x = \"Treatment\",\n         y = \"Expression relative to vehicle control\",\n         color = \"Treatment duration\"\n         ) + \n    scale_y_continuous(limits = c(0, NA)) +\n    theme_bw() +\n    theme(axis.text.x = element_text(angle = 30, hjust = 1),\n          axis.title.y = element_text(vjust = 3, face = \"bold\"),\n          axis.title.x = element_text(vjust = -1.5, face =\"bold\"),\n          plot.title = element_text(face = \"bold\"),\n          legend.title = element_text(face = \"bold\"),\n          legend.position = \"bottom\"\n       ) +\n    geom_hline(yintercept = 1, linetype = \"dashed\")\n\nact_3A4_IL1B\n```\n\n::: {.cell-output-display}\n![Mean CYP3A4 activity relative to vehicle control after IL-1B treatment. Facetted on time. 24 hour timepoints removed](LCMS_files/figure-html/fig-act-cyp3A4-IL1B-1.png){#fig-act-cyp3A4-IL1B width=960}\n:::\n:::\n\n\n\n\n\n\n### Timepoints combined\nIL-6\n\n\n\n\n\n::: {#cell-fig-act-il6-combined .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-act-il6-combined\n#| fig-cap: \"Overall mean CYP3A4 activity relative to vehicle control after IL-6 treatment. 24 hour timepoints removed\"\n\nIL6_combined_data <- \n  data[time_incubation == 0.5\n       & treatment %in% group_IL6\n       & time_treatment != 24]\n\nIL6_combined_data[,\n                  overall_mean := mean(mean_relative_amount),\n                  by = .(treatment)]\n\n\nggplot(data = IL6_combined_data) +\n  geom_point(aes(x = treatment,\n                 y = relative_amount,\n                 color = factor(time_treatment)\n                 ),\n             size = 5,\n             alpha = 0.7\n             ) +\n  scale_color_brewer(palette = \"Set2\") +\n  geom_point(aes(x = treatment,\n                 y = overall_mean),\n             size = 10,\n             alpha = 0.1\n             ) +\n  labs(title = \"CYP3A4 activity relative to vehicle control after IL-6 treatment\",\n       x = \"Treatment\",\n       y = \"Expression relative to vehicle control\",\n       color = \"Treatment duration\"\n       ) +\n  geom_hline(yintercept = 1, linetype = \"dashed\") +\n  theme_bw() +\n  theme(#axis.text.x = element_text(angle = 30, hjust = 1),\n        axis.title.y = element_text(vjust = 3, face = \"bold\"),\n        axis.title.x = element_text(vjust = -1.5, face =\"bold\"),\n        plot.title = element_text(face = \"bold\"),\n        legend.title = element_text(face = \"bold\"),\n        legend.position = \"bottom\"\n     ) +\n  scale_y_continuous(limits = c(0, NA))\n```\n\n::: {.cell-output-display}\n![Overall mean CYP3A4 activity relative to vehicle control after IL-6 treatment. 24 hour timepoints removed](LCMS_files/figure-html/fig-act-il6-combined-1.png){#fig-act-il6-combined width=672}\n:::\n:::\n\n\n\n\n\n\n\nIL-1B\n\n\n\n\n\n::: {#cell-fig-act-il1b-combined .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-act-il1b-combined\n#| fig-cap: \"Overall mean CYP3A4 activity relative to vehicle control after IL-1B treatment. 24 hour timepoints removed\"\n\nIL1B_combined_data <- \n  data[time_incubation == 0.5\n       & treatment %in% group_IL1B\n       & time_treatment != 24]\n\nIL1B_combined_data[,\n                  overall_mean := mean(mean_relative_amount),\n                  by = .(treatment)]\n\n\nggplot(data = IL1B_combined_data) +\n  geom_point(aes(x = treatment,\n                 y = relative_amount,\n                 color = factor(time_treatment)\n                 ),\n             size = 5,\n             alpha = 0.7\n             ) +\n  scale_color_brewer(palette = \"Set2\") +\n  geom_point(aes(x = treatment,\n                 y = overall_mean),\n             size = 10,\n             alpha = 0.1\n             ) +\n  labs(title = \"CYP3A4 activity relative to vehicle control after IL-1B treatment\",\n       x = \"Treatment\",\n       y = \"Expression relative to vehicle control\",\n       color = \"Treatment duration\"\n       ) +\n  geom_hline(yintercept = 1, linetype = \"dashed\") +\n  theme_bw() +\n  theme(#axis.text.x = element_text(angle = 30, hjust = 1),\n        axis.title.y = element_text(vjust = 3, face = \"bold\"),\n        axis.title.x = element_text(vjust = -1.5, face =\"bold\"),\n        plot.title = element_text(face = \"bold\"),\n        legend.title = element_text(face = \"bold\"),\n        legend.position = \"bottom\"\n     ) +\n  scale_y_continuous(limits = c(0, NA))\n```\n\n::: {.cell-output-display}\n![Overall mean CYP3A4 activity relative to vehicle control after IL-1B treatment. 24 hour timepoints removed](LCMS_files/figure-html/fig-act-il1b-combined-1.png){#fig-act-il1b-combined width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n## EC50\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nEC50_data <- readRDS(here(\"notebooks/LCMS/data_processed/final_data.rds\"))\n\n# Create groups/look up tables for subsetting data\ngroup_IL6 <- c(\"control\", \n               #\"medium\", \n               \"0.01 ng/ml IL-6\", \n               \"0.1 ng/ml IL-6\",\n               \"1 ng/ml IL-6\", \n               \"10 ng/ml IL-6\"\n               )\n\ngroup_IL1B <- c(\"control\", \n                #\"medium\", \n                \"0.01 ng/ml IL-1B\", \n                \"0.1 ng/ml IL-1B\",\n                \"1 ng/ml IL-1B\",\n                \"10 ng/ml IL-1B\"\n                )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nEC50_IL6 <- EC50_data[treatment %in% group_IL6]\n\n#fwrite(EC50_IL6, file = here(\"notebooks/LCMS/EC50_IL6.csv\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.3     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ lubridate 1.9.3     ✔ tibble    3.2.1\n✔ purrr     1.0.2     ✔ tidyr     1.3.0\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::between()     masks data.table::between()\n✖ dplyr::filter()      masks stats::filter()\n✖ dplyr::first()       masks data.table::first()\n✖ lubridate::hour()    masks data.table::hour()\n✖ lubridate::isoweek() masks data.table::isoweek()\n✖ dplyr::lag()         masks stats::lag()\n✖ dplyr::last()        masks data.table::last()\n✖ lubridate::mday()    masks data.table::mday()\n✖ lubridate::minute()  masks data.table::minute()\n✖ lubridate::month()   masks data.table::month()\n✖ lubridate::quarter() masks data.table::quarter()\n✖ lubridate::second()  masks data.table::second()\n✖ purrr::transpose()   masks data.table::transpose()\n✖ lubridate::wday()    masks data.table::wday()\n✖ lubridate::week()    masks data.table::week()\n✖ lubridate::yday()    masks data.table::yday()\n✖ lubridate::year()    masks data.table::year()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(minpack.lm)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nEC50_IL6 <- EC50_IL6 %>%\n  mutate(Concentration = case_when(\n    treatment == \"control\" ~ 0, # Assign 0 to control\n    TRUE ~ as.numeric(gsub(\".*?(\\\\d+\\\\.?\\\\d*).*\", \"\\\\1\", treatment)) # Extract numeric values\n  ))\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: There was 1 warning in `mutate()`.\nℹ In argument: `Concentration = case_when(...)`.\nCaused by warning:\n! NAs introduced by coercion\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n# Check for NAs in Concentration to ensure parsing was successful\nsum(is.na(EC50_IL6$Concentration))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# The 4-parameter logistic model function remains the same\nfourPL <- function(x, Top, Bottom, IC50, HillSlope) {\n  Bottom + (Top - Bottom) / (1 + (x / IC50)^(-HillSlope))\n}\n\n# Ensure EC50_IL6 is filtered and contains no NA values for the fitting\nEC50_IL6_filtered <- EC50_IL6 %>% filter(!is.na(Concentration) & Concentration > 0 & !is.na(relative_amount))\n\n# Adjust initial parameter estimates\nTop_est <- max(EC50_IL6_filtered$relative_amount, na.rm = TRUE)\nBottom_est <- min(EC50_IL6_filtered$relative_amount, na.rm = TRUE)\nIC50_est <- median(EC50_IL6_filtered$Concentration, na.rm = TRUE) # Assuming this is a reasonable estimate\nHillSlope_est <- 1 # Starting with a neutral slope\n\n# Fit the model with adjusted initial estimates\nmodel <- tryCatch({\n  nlsLM(relative_amount ~ fourPL(Concentration, Top, Bottom, IC50, HillSlope), \n        data = EC50_IL6_filtered, \n        start = list(Top = Top_est, Bottom = Bottom_est, IC50 = IC50_est, HillSlope = HillSlope_est))\n}, error = function(e) e)\n\n# Check if model fitting was successful\nif(inherits(model, \"error\")) {\n  print(\"Model fitting encountered an error:\")\n  print(model$message)\n} else {\n  print(\"Model fitted successfully.\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Model fitted successfully.\"\n```\n\n\n:::\n:::\n\n::: {#cell-fig-dose-response-act-il6 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-dose-response-act-il6\n\n# Generate predictions from the model across a range of concentrations\nnew_data <- data.frame(Concentration = seq(min(EC50_IL6_filtered$Concentration, na.rm = TRUE), \n                                           max(EC50_IL6_filtered$Concentration, na.rm = TRUE), length.out = 100))\nnew_data$Predicted <- predict(model, newdata = new_data)\n\n# Plot the dose-response curve\nggplot() +\n  geom_point(data = EC50_IL6_filtered, aes(x = Concentration, y = relative_amount), color = \"blue\") +\n  geom_line(data = new_data, aes(x = Concentration, y = Predicted), color = \"red\") +\n  labs(title = \"Dose-response curve\", x = \"Concentration\", y = \"Relative Activity\") +\n  theme_minimal() +\n  scale_x_log10()\n```\n\n::: {.cell-output-display}\n![](LCMS_files/figure-html/fig-dose-response-act-il6-1.png){#fig-dose-response-act-il6 width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# Print the summary of the fitted model to see parameter estimates\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFormula: relative_amount ~ fourPL(Concentration, Top, Bottom, IC50, HillSlope)\n\nParameters:\n           Estimate Std. Error t value Pr(>|t|)    \nTop       4.436e-01  8.847e-02   5.014 1.93e-06 ***\nBottom    1.000e+00  7.500e-02  13.339  < 2e-16 ***\nIC50      9.447e-01  6.429e+03   0.000        1    \nHillSlope 7.190e+00  8.604e+05   0.000        1    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.4108 on 116 degrees of freedom\n\nNumber of iterations to convergence: 10 \nAchieved convergence tolerance: 1.49e-08\n```\n\n\n:::\n:::\n",
    "supporting": [
      "LCMS_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
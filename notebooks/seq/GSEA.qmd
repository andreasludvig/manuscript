---
title: "Geneset enrichment analysis"
editor_options: 
  chunk_output_type: console
---

## Pathway/gene set enrichment analysis

After differential gene expression (DGE) analysis we have a long list of differentially expressed genes. Pathway enrichment analysis (PEA) is a common approach to summarise this long list of genes and interpret hundreds of DGEs at once. So instead of having a list of 20 000 genes, we may get a list of 50 or 60 biological pathways.

![Summarise lists of DGEs to pathways](/images/GSE_analysis/pea.png)

Pathway enrichment analysis summarises the long gene list to a shorter and more easily interpretable list of pathways.

### How does PEA work?

For a pathway enrichment analysis we need 3 ingredients.

1.  Our **gene list** of interest, fx. a list of DGEs which we want to summarise.
2.  A list of **background genes** - fx all of the genes in the human genome/transcriptome.
3.  A list of **gene sets**. Gene sets are basically groups of related genes. Of course, for the algorithm to know if your list has a lot of genes related to breast cancer, or apoptosis, or cellular respiration, you need to tell it which genes are actually involved in breast cancer, apoptosis, and cellular respiration.

![Components of a pathway enrichment analysis](/images/GSE_analysis/pea_2.png)

PEA essentially compares our gene list to the background list to check if there are certain pathways **overrepresented**

One example could be: Alcoholic liver disease is usually involved in inflammatory processes, which often involve pro-inflammatory cytokines like IL-6. So, is there an **association** between our genes differentially expressed in alcoholic liver disease vs healthy cells and IL-6 production.

![](/images/GSE_analysis/pea_3.png)

Is our list of DGEs **enriched** with genes involved in IL-6 synthesis pathway?

![](/images/GSE_analysis/pea_4.png)

To answer this question, we can build a contigency table. This will help us determine whether the fraction of genes of interest in the pathway is higher compared to the fraction of genes outside the pathway (so, backgound set). See the table below.

![](/images/GSE_analysis/pea_5.png)

We have a column for differentially expressed and a column not differentially expressed genes, and then two rows, for genes that are annotated as being involved in IL-6 production and genes that are not involved in IL6 production.

To simplify things a lot, we will just look at 30 genes. 15 deferentially expressed genes were identified and of those, 12 genes were associated with the GO term interleukin-6 production.

We find that **12 of our 15** differentially expressed genes are involved in IL-6 production. We could quite confidently say that **our gene list is enriched with genes involved in IL-6 production.**

But what if there was 9 of our 15 involved in IL-6 production. is our gene list enriched with genes involved in IL-6 production? We need an objective statistical test to determine what is enriched and what is not. There are many methods, by the one that is commonly used in pathway enrichment analysis is fisher's exact test. I our p-value is really lwo we can safely say that our list is overrepresented with genes involved in IL-6 production, in other words, IL-6 prodcution is an immportant pathway in alchoholic liver diseases compared to healthy liver cells. Becayse we a testing thousands of pathways we till have to adjust p-values with a multiple-testing correction method.

Pathway enrichment analysis takes your **gene list** of interest and compares it to a **list of background genes** to check if there are certain pathways that are over-represented.

So it checks the fraction of your genes annotated to a specific Gene Ontology (GO) term. Then it checks the proportion of genes in the whole genome (your background set) that are annotated to that GO Term.

Then, it gives you a **p-value** which tells you what is the probability that that pathway is actually over-represented in your gene list and it wasn't just coincidence.

### Our analysis

Mark Burton have done the GSE analysis using four different databases, outlined below. I think we just use the vehicle control as the list of background genes. Otherwise he must have used some subset of only genes/pathways related to PHHs.

Gene Ontology (GO), KEGG, Reactome, and BioCarta are databases and tools that provide comprehensive information on gene and protein functions, interactions, and pathways. Each has its unique focus and strengths:

1.  **Gene Ontology (GO)**

    -   **Focus:** Provides a standardized vocabulary (ontologies) to describe gene and protein roles in cells. It covers three domains: Biological Process (BP), which describes the biological objectives to which the gene or gene product contributes; Molecular Function (MF), which describes the elemental activities of a gene product at the molecular level, such as binding or catalysis; and Cellular Component (CC), which describes where in the cell the gene product is active.

    -   **Strengths:** Widely used for annotating genes and gene products across species; facilitates consistent descriptions of gene products even in the context of different studies.

2.  **Kyoto Encyclopedia of Genes and Genomes (KEGG)**

    -   **Focus:** Integrates genomic, chemical, and systemic functional information. KEGG provides pathways maps that represent molecular interaction and reaction networks, covering metabolism, genetic information processing, environmental information processing, cellular processes, organismal systems, and human diseases.

    -   **Strengths:** Comprehensive in linking genes to functions through networks of interactions; useful for understanding high-level functions and utilities of the biological system.

3.  **Reactome**

    -   **Focus:** A curated database of pathways and reactions in human biology. Reactome pathways encompass various processes such as metabolism, signal transduction, gene expression, and cell cycle. It aims to provide a detailed, visual representation of molecular processes.

    -   **Strengths:** Highly detailed and manually curated; provides an interactive pathway browser that facilitates the exploration of complex biological pathways; also includes pathways from other species, providing a comparative perspective.

4.  **BioCarta**

    -   **Focus:** Earlier widely used for providing graphical representations of molecular pathways, focusing on various biological and signaling pathways. BioCarta's pathways were known for highlighting the interactions between different molecules and the potential regulation mechanisms.

    -   **Strengths:** Although less updated and less comprehensive than other databases mentioned, BioCarta pathways have been historically significant for offering insights into specific signaling and molecular pathways, contributing to the understanding of complex biological processes.

## Visualization of GSEA

#### Setup

```{r}
library(here)
library(readxl)
library(tidyverse)

path_raw_data <- here("notebooks/seq/data_raw/GSEA/")
```

### IL-1B 10 ng

#### KEGG

Testing just KEGG. Getting the code to work for one file.

```{r}
gsea_data <- read_excel(here(path_raw_data, "KEGG_IL1B_10_vs_vehicle.xlsx"))
```

```{r}
plot_data <- 
  arrange(gsea_data, -abs(NES)) %>% 
    group_by(sign(NES)) %>%
    slice(1:20)
```

```{r}
ggplot(data = plot_data,
       aes(x = NES,
           y = fct_reorder(pathway, NES),
           fill = padj
           )
       ) +
  geom_bar(stat = "identity") +
  scale_fill_distiller(type = "seq", palette = "YlOrRd")
  #scale_fill_continuous(low='red', high='blue', guide=guide_colorbar(reverse=TRUE), ) 
```

```{r}
ggplot(plot_data, aes(x = NES, y = fct_reorder(pathway, NES), color = padj, size = size)) + 
  geom_point(stat = 'identity') + 
  xlab("ratio") + ylab("path") + ggtitle("your data") + 
  theme_bw() + 
  scale_color_distiller(type = "seq", palette = "YlOrRd")
```

### All KEGG plots

Plot all using a function
```{r}
# Get file paths
kegg_file_paths <- dir(here("notebooks/seq/data_raw/GSEA"), pattern = "KEGG", full.names = TRUE)

# Subset to interleukines if wanted
#kegg_file_paths[grep(pattern = "IL", kegg_file_paths)]
```

```{r}
KEGG_plot_list <- map(kegg_file_paths, function(file_path) {
  # Read the file
  plot_data <- read_excel(file_path)
  
  # Process the data
  processed_data <- plot_data %>%
    arrange(desc(abs(NES))) %>%
    group_by(sign_NES = sign(NES)) %>%
    slice_head(n = 20) %>%
    ungroup() %>%
    filter(padj <= 0.05)
  
  # Generate the plot
  ggplot(processed_data,
         aes(x = NES,
             y = fct_reorder(pathway, NES),
             color = padj,
             size = size
             )
         ) +
    geom_point(stat = 'identity') +
    labs(x = "NES",
         y = "Pathway",
         title = paste("Top 20 Pathways for","", basename(file_path))
         ) +
    theme_bw() +
    scale_color_distiller(type = "seq", palette = "YlOrRd") #+
    #theme(legend.position = "none") # Remove legend to focus on the data
})

```

```{r}
#| label: fig-kegg-plots1

KEGG_plot_list[[1]]
```

```{r}
#| label: fig-kegg-plots2

KEGG_plot_list[[2]]
```

```{r}
#| label: fig-kegg-plots3

KEGG_plot_list[[3]]
```

```{r}
#| label: fig-kegg-plots4

KEGG_plot_list[[4]]
```

```{r}
#| label: fig-kegg-plots5

KEGG_plot_list[[5]]
```

```{r}
#| label: fig-kegg-plots6

KEGG_plot_list[[6]]
```

```{r}
#| label: fig-kegg-plots7

KEGG_plot_list[[7]]
```

```{r}
#| label: fig-kegg-plots8

KEGG_plot_list[[8]]
```


#### BIOCARTA

**Plot all using a function**

Get all file paths related to BIOCARTA
```{r}
# Get file paths
biocarta_file_paths <- dir(here("notebooks/seq/data_raw/GSEA"), pattern = "BIOCARTA", full.names = TRUE)

# Subset to interleukines if wanted
# kegg_file_paths[grep(pattern = "IL", kegg_file_paths)]
```

```{r}
BIOCARTA_plot_list <- map(biocarta_file_paths, function(file_path) {
  # Read the file
  plot_data <- read_excel(file_path)
  
  # Process the data
  processed_data <- plot_data %>%
    arrange(desc(abs(NES))) %>%
    group_by(sign_NES = sign(NES)) %>%
    slice_head(n = 20) %>%
    ungroup() %>%
    filter(padj <= 0.05)
  
  # Generate the plot
  ggplot(processed_data, aes(x = NES, y = fct_reorder(pathway, NES), color = padj, size = size)) +
    geom_point(stat = 'identity') +
    labs(x = "NES", y = "Pathway", title = paste("Top 20 Pathways for","", basename(file_path))) +
    theme_bw() +
    scale_color_distiller(type = "seq", palette = "YlOrRd") #+
    #theme(legend.position = "none") # Remove legend to focus on the data
})

print(BIOCARTA_plot_list)
```

### GO

Split data into each of the GO databases:

1.  **Biological Process (BP)**, which describes the biological objectives to which the gene or gene product contributes.
2.  **Molecular Function (MF**), which describes the elemental activities of a gene product at the molecular level, such as binding or catalysis.
3.  **Cellular Component (CC)**, which describes where in the cell the gene product is active.

### REACTOME
